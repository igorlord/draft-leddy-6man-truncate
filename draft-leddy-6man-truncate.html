<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>IPv6 Packet Truncation</title>

  
<style type="text/css">/*<![CDATA[*/

body {
  font: 16px "Helvetica Neue","Open Sans",Helvetica,Calibri,sans-serif;
  color: #333;
  font-size-adjust: 0.5;
  line-height: 24px;
  margin: 75px auto;
  max-width: 624px;
  padding: 0 5px;
}

.title, .filename, h1, h2, h3, h4, h5 {
  font: 16px "Roboto Condensed","Helvetica Neue","Open Sans",Helvetica,Calibri,sans-serif;
  font-size-adjust: 0.5;
  font-weight: bold;
  color: #333;
  line-height: 100%;
  margin: 1.2em 0 0.3em;
}
.title, #rfc\.title h1 { font-size: 32px; }
h1, section h1, h2, section h2, section h3, nav h2 { font-size: 20px; }
h3, section h4, h4, section h5 { font-size: 16px; }
h1 a[href], h2 a[href], h3 a[href], h4 a[href] {
  color: #333;
}

table {
  margin-left: 0em;
  border-collapse: collapse;
}
th {
  text-align: left;
  border-bottom: 2px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
  vertical-align: top;
}
tr:nth-child(2n+1) > td,
tr:nth-child(2n+1) > th {
  background-color: #f9f9f9;
}
td.reference {
  max-width: 200px;
  border-top: none;
  padding-right: 1em;
}
.right {
  text-align: right;
}


table.header, table#rfc\.headerblock {
  width: 100%;
}
table.header td, table#rfc\.headerblock td {
  border: none;
  background-color: transparent;
  color: black;
  padding: 0;
}
.filename {
  display: block;
  color: rgb(119, 119, 119);
  font-size: 20px;
  font-weight: normal;
  line-height: 100%;
  margin: 10px 0 32px;
}
#rfc\.abstract+p, #rfc\.abstract p {
  font-size: 20px;
  line-height: 28px;
}

samp, tt, code, pre {
  font: 15px Consolas, monospace;
  font-size-adjust: none;
}
pre {
  background-color: #eee;
  border: 1px solid #ddd;
  overflow-x: auto;
  padding: 5px;
  margin: 5px;
}
.figure, caption {
  font-style: italic;
  margin: 0 1.5em;
  text-align: left;
}

address {
  margin: 16px 2px;
  line-height: 20px;
}
.vcard {
  font-style: normal;
}
.vcardline {
  display: block;
}
.vcardline .fn, address b {
  font-weight: normal;
}
.vcardline .hidden {
  display: none;
}

dl {
  margin-left: 1em;
}
dl.dl-horizontal: {
  margin-left: 0;
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl.nohang > dt {
  float: none;
}
dl > dd {
  margin-bottom: .5em;
}
dl.compact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}
ul.empty {
  list-style-type: none;
}
ul.empty li {
  margin-top: .5em;
}

hr {
  border: 0;
  border-top: 1px solid #eee;
}
hr.noprint {
  display: none;
}

a {
  text-decoration: none;
}
a[href] {
  color: #2a6496;
}
a[href]:hover {
  background-color: #eee;
}

p, ol, ul, li {
  padding: 0;
}
p {
  margin: 0.5em 0;
}
ol, ul {
  margin: 0.2em 0 0.2em 2em;
}
li {
  margin: 0.2em 0;
}
address {
  font-style: normal;
}

ul.toc ul {
  margin: 0 0 0 2em;
}
ul.toc li {
  list-style: none;
  margin: 0;
}

@media screen and (min-width: 924px) {
  body {
    padding-right: 350px;
  }
  body>ul.toc, body>#rfc\.toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 500px);
    width: 300px;
    z-index: 1;
    overflow: auto;
    overscroll-behavior: contain;
  }
  body>#rfc\.toc {
    top: 55px;
  }
  body>ul.toc {
    top: 100px;
  }

  ul.toc {
    margin: 0 0 0 4px;
    font-size: 12px;
    line-height: 20px;
  }
  ul.toc ul {
    margin-left: 1.2em;
  }
}

.github-fork-ribbon-wrapper {
  display: none;
}
@media screen and (min-width: 800px) {
  /* "Fork me on GitHub" CSS ribbon based on
   * https://github.com/simonwhitaker/github-fork-ribbon-css
   */
  .github-fork-ribbon {
    position: absolute;
    padding: 2px 0;
    background-color: #a00;
    background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));
    box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);
    font: 700 12px "Helvetica Neue", Helvetica, Arial, sans-serif;

    pointer-events: auto;

    top: 38px;
    right: -45px;

    transform: rotate(45deg);
  }

  .github-fork-ribbon a[href],
  .github-fork-ribbon a[href]:hover {
    color: #fff;
    background-color: transparent;
    text-decoration: none;
    text-shadow: 0 -1px rgba(0, 0, 0, 0.5);
    text-align: center;

    width: 190px;
    line-height: 18px;

    display: inline-block;
    padding: 2px 0;

    border: 1.5px dotted #fff;
    border-color: rgba(255, 255, 255, 0.6);
  }

  .github-fork-ribbon-wrapper {
    display: block;
    width: 130px;
    height: 130px;
    position: absolute;
    overflow: hidden;
    top: 0; right: 0;
    z-index: 2;
    pointer-events: none;
  }
}
@media screen and (min-width: 1000px) {
  .github-fork-ribbon-wrapper {
    position: fixed;
  }
  /*]]>*/</style>
  <meta name="viewport" content="initial-scale=1.0">


  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Requirements Language">
<link href="#rfc.section.3" rel="Chapter" title="3 Operational Considerations">
<link href="#rfc.section.4" rel="Chapter" title="4 IPv6 Destination Options">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 The Truncation Eligible Option">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 The Truncated Packet Option">
<link href="#rfc.section.5" rel="Chapter" title="5 Reference Topology">
<link href="#rfc.section.6" rel="Chapter" title="6 Truncation Procedures">
<link href="#rfc.section.7" rel="Chapter" title="7 Backwards Compatibility">
<link href="#rfc.section.8" rel="Chapter" title="8 Checksum Considerations">
<link href="#rfc.section.9" rel="Chapter" title="9 Invalid Packet Types">
<link href="#rfc.section.10" rel="Chapter" title="10 Network Considerations">
<link href="#rfc.section.11" rel="Chapter" title="11 Encapsulating Security Payload Considerations">
<link href="#rfc.section.12" rel="Chapter" title="12 Extension Header Considerations">
<link href="#rfc.section.13" rel="Chapter" title="13 Security Considerations">
<link href="#rfc.section.14" rel="Chapter" title="14 IANA Considerations">
<link href="#rfc.section.15" rel="Chapter" title="15 Acknowledgements">
<link href="#rfc.references" rel="Chapter" title="16 References">
<link href="#rfc.references.1" rel="Chapter" title="16.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="16.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content="xml2rfc version 2.10.3 - https://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Leddy, J., Bonica, R., and I. Lubashev" />
  <meta name="dct.identifier" content="urn:ietf:id:draft-leddy-6man-truncate-latest" />
  <meta name="dct.issued" scheme="ISO8601" content="2018-09" />
  <meta name="dct.abstract" content="This document defines IPv6 packet truncation procedures. These procedures make Path MTU Discovery (PMTUD) more reliable. Upper-layer protocols can leverage these procedures in order to take advantage of larger MTUs." />
  <meta name="description" content="This document defines IPv6 packet truncation procedures. These procedures make Path MTU Discovery (PMTUD) more reliable. Upper-layer protocols can leverage these procedures in order to take advantage of larger MTUs." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">6man</td>
<td class="right">J. Leddy</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Unaffiliated</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">R. Bonica</td>
</tr>
<tr>
<td class="left">Expires: April 12, 2019</td>
<td class="right">Juniper Networks</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">I. Lubashev</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Akamai Technologies</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">October 9, 2018</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">IPv6 Packet Truncation<br />
  <span class="filename">draft-leddy-6man-truncate-latest</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document defines IPv6 packet truncation procedures. These procedures make Path MTU Discovery (PMTUD) more reliable. Upper-layer protocols can leverage these procedures in order to take advantage of larger MTUs.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of This Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at https://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on April 12, 2019.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2018 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (https://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Requirements Language</a>
</li>
<li>3.   <a href="#rfc.section.3">Operational Considerations</a>
</li>
<li>4.   <a href="#rfc.section.4">IPv6 Destination Options</a>
</li>
<ul><li>4.1.   <a href="#rfc.section.4.1">The Truncation Eligible Option</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">The Truncated Packet Option</a>
</li>
</ul><li>5.   <a href="#rfc.section.5">Reference Topology</a>
</li>
<li>6.   <a href="#rfc.section.6">Truncation Procedures</a>
</li>
<li>7.   <a href="#rfc.section.7">Backwards Compatibility</a>
</li>
<li>8.   <a href="#rfc.section.8">Checksum Considerations</a>
</li>
<li>9.   <a href="#rfc.section.9">Invalid Packet Types</a>
</li>
<li>10.   <a href="#rfc.section.10">Network Considerations</a>
</li>
<li>11.   <a href="#rfc.section.11">Encapsulating Security Payload Considerations</a>
</li>
<li>12.   <a href="#rfc.section.12">Extension Header Considerations</a>
</li>
<li>13.   <a href="#rfc.section.13">Security Considerations</a>
</li>
<li>14.   <a href="#rfc.section.14">IANA Considerations</a>
</li>
<li>15.   <a href="#rfc.section.15">Acknowledgements</a>
</li>
<li>16.   <a href="#rfc.references">References</a>
</li>
<ul><li>16.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>16.2.   <a href="#rfc.references.2">Informative References</a>
</li>
</ul><li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#Intro" id="Intro">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">An Internet path connects a source node to a destination node. A path can contain links and routers.</p>
<p id="rfc.section.1.p.2">Each link is constrained by the number of bytes that it can convey in a single IP packet. This constraint is called the link Maximum Transmission Unit (MTU). <a href="#IPv6" class="xref">[IPv6]</a> requires every link to have an MTU of 1280 bytes or greater. This value is called IPv6 minimum link MTU.</p>
<p id="rfc.section.1.p.3">Likewise, each Internet path is constrained by the number of bytes that it can convey in a single IP packet. This constraint is called the Path MTU (PMTU). For any given path, the PMTU is equal to the smallest of its link MTUs.</p>
<p id="rfc.section.1.p.4">IPv6 allows fragmentation at the source node only. If an IPv6 source node sends a packet whose length exceeds the PMTU, an intermediate node will discard the packet. In order to prevent this, IPv6 nodes can either:</p>
<p></p>

<ul>
<li>Refrain from sending packets whose length exceeds the IPv6 minimum link MTU.</li>
<li>Maintain a running estimate of the PMTU and refrain from sending packets whose length exceeds that estimate.</li>
</ul>
<p id="rfc.section.1.p.6">In order to maintain a running estimate of the PMTU, IPv6 nodes can execute Path MTU Discovery (PMTUD) <a href="#RFC8201" class="xref">[RFC8201]</a> procedures. In these procedures, the source node produces an initial PMTU estimate. This initial estimate equals the MTU of the first link along the path to the destination. It can be greater than the actual PMTU.</p>
<p id="rfc.section.1.p.7">Having produced an initial PMTU estimate, the source node sends packets to the destination node. If one of these packets is larger than the actual PMTU, an intermediate node will not be able to forward the packet through the next link along the path. Therefore, the intermediate node discards the packet and sends an Internet Control Message Protocol (ICMP) <a href="#RFC4443" class="xref">[RFC4443]</a> Packet Too Big (PTB) message to the source node. The ICMP PTB message indicates the MTU of the link through which the packet could not be forwarded. The source node uses this information to refine its PMTU estimate.</p>
<p id="rfc.section.1.p.8">PMTUD relies on the network to deliver ICMP PTB messages from the intermediate node to the source node. If the network cannot deliver these messages, a persistent black hole can develop. In this scenario, the source node sends a packet whose length exceeds the PMTU. An intermediate node discards the packet and sends an ICMP PTB message to the source. However, the network cannot deliver the ICMP PTB message to the source. Therefore, the source node does not update its PMTU estimate and it continues to send packets whose length exceeds the PMTU. The intermediate node discards these packets and sends more ICMP PTB messages to the source. These ICMP PTB messages are lost, exactly as previous ICMP PTB messages were lost.</p>
<p id="rfc.section.1.p.9">In some operational scenarios <a href="#OpCon" class="xref">Section 3</a>, networks cannot deliver ICMP PTB messages from an intermediate node to the source node. Therefore, enhanced procedures are required.</p>
<p id="rfc.section.1.p.10">This document defines IPv6 packet truncation procedures. When an IPv6 source node originates a packet, it executes the following procedure:</p>
<p></p>

<ul>
<li>Marks the packet as being eligible for truncation.</li>
<li>Forward the packet towards its destination.</li>
</ul>
<p id="rfc.section.1.p.12">If an intermediate node cannot forward the packet because of an MTU issue, it executes the following procedure:</p>
<p></p>

<ul>
<li>Detect that the packet is eligible for truncation.</li>
<li>Send an ICMP PTB message to the source node, with the MTU field indicating the MTU of the link through which the packet could not be forwarded.</li>
<li>Truncate the packet.</li>
<li>Mark the packet as being truncated.</li>
<li>Update the packet&#8217;s upper-layer checksum (if possible).</li>
<li>Forward the packet towards its destination.</li>
</ul>
<p id="rfc.section.1.p.14">When the destination node receives the packet, it executes the following procedure:</p>
<p></p>

<ul>
<li>Detect that the packet has been truncated.</li>
<li>Send an ICMP PTB message to the source node, with the MTU field indicating the length of the truncated packet.</li>
<li>Discard the packet.</li>
</ul>
<p id="rfc.section.1.p.16">Both ICMP PTB messages, mentioned above, contain MTU information that the source node can use to refine its PMTU estimate.</p>
<p id="rfc.section.1.p.17">The procedures described herein prevent incomplete (i.e., truncated) data from being delivered to upper-layer protocols. While IPv6 packet truncation may facilitate new upper-layer procedures, upper-layer procedures are beyond the scope of this document.</p>
<p id="rfc.section.1.p.18">The procedures described herein make PMTUD more reliable by increasing the probability that the source node will receive ICMP PTB feedback from a downstream device. Even when the network cannot deliver ICMP PTB messages from an intermediate router to a source node, it may be able to deliver an ICMP PTB messages from the destination node to the source node.</p>
<p id="rfc.section.1.p.19">However, the procedures described herein do not make PMTUD one hundred per cent reliable. In some operational scenarios, the network cannot deliver any ICMP messages to the source node, regardless of their origin.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#ReqLang" id="ReqLang">Requirements Language</a>
</h1>
<p id="rfc.section.2.p.1">The key words &#8220;MUST&#8221;, &#8220;MUST NOT&#8221;, &#8220;REQUIRED&#8221;, &#8220;SHALL&#8221;, &#8220;SHALL NOT&#8221;, &#8220;SHOULD&#8221;, &#8220;SHOULD NOT&#8221;, &#8220;RECOMMENDED&#8221;, &#8220;NOT RECOMMENDED&#8221;, &#8220;MAY&#8221;, and &#8220;OPTIONAL&#8221; in this document are to be interpreted as described in BCP 14 <a href="#RFC2119" class="xref">[RFC2119]</a> <a href="#RFC8174" class="xref">[RFC8174]</a> when, and only when, they appear in all capitals, as shown here.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#OpCon" id="OpCon">Operational Considerations</a>
</h1>
<p id="rfc.section.3.p.1">The packet truncation procedures described herein make PMTUD more resilient when:</p>
<p></p>

<ul>
<li>The network can deliver ICMP messages from the destination node to the source node.</li>
<li>The network cannot deliver ICMP messages from an intermediate node to the source node.</li>
</ul>
<p id="rfc.section.3.p.3">The following are common operational scenarios in which packet truncation procedures can make PMTUD more resilient:</p>
<p></p>

<ul>
<li>The destination node has a viable route to the source node, but the intermediate node does not.</li>
<li>The source node is protected by a firewall that administratively blocks all packets except for those from specified subnetworks. The destination node resides in one of the specified subnetworks, but the intermediate node does not.</li>
<li>The source address of the original packet (i.e., the packet that elicited the ICMP message) was an anycast address. Therefore, the destination address of the ICMP message is the same anycast address.  In this case, an ICMP message from the destination node is likely to be delivered to the correct anycast instance. By contrast, an ICMP message from an intermediate node is less likely to be delivered to the correct anycast instance.</li>
</ul>
<p id="rfc.section.3.p.5">Packet truncation procedures do not make PMTUD more resilient when the network cannot reliably deliver any ICMP messages to the source node. The following are operational scenarios where the network cannot reliably deliver any ICMP PTB messages to the source node:</p>
<p></p>

<ul>
<li>The source node is protected by a firewall that administratively blocks all ICMP messages.</li>
<li>The source node is an anycast instance served by a load-balancer as defined in <a href="#RFC7690" class="xref">[RFC7690]</a>. The load-balancer does not implement the mitigations defined in <a href="#RFC7690" class="xref">[RFC7690]</a>.</li>
</ul>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#ipv6-destination-options" id="ipv6-destination-options">IPv6 Destination Options</a>
</h1>
<p id="rfc.section.4.p.1">This document defines the following IPv6 Destination options:</p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> <a href="#TuncEilig" id="TuncEilig">The Truncation Eligible Option</a>
</h1>
<p id="rfc.section.4.1.p.1">The Truncation Eligible option indicates that the packet is eligible for truncation. It also indicates that the packet has not been truncated.</p>
<p id="rfc.section.4.1.p.2">The Truncation Eligible option contains the following fields:</p>
<p></p>

<ul>
<li>Option Type - Truncation Eligible option. Value TBD by IANA. See Notes below.</li>
<li>Opt Data Len - Length of Option Data, measured in bytes. MUST be equal to 0.</li>
</ul>
<p id="rfc.section.4.1.p.4">IPv6 packets that include the Fragment header MUST NOT include the Truncation Eligible option.</p>
<p id="rfc.section.4.1.p.5">IPv6 packets whose length is less than the IPv6 minimum link MTU SHOULD NOT include the Truncation Eligible option.</p>
<p id="rfc.section.4.1.p.6">The IPv6 Hop-by-hop Options header SHOULD NOT include the Truncation Eligible option.</p>
<p id="rfc.section.4.1.p.7">The IPv6 Destination Options header:</p>
<p></p>

<ul>
<li>MAY include a single instance of the Truncation Eligible option.</li>
<li>SHOULD NOT include multiple instances of the Truncation Eligible option.</li>
<li>MUST NOT include both the Truncation Eligible option and the Truncated Packet option <a href="#TruncatedOpt" class="xref">Section 4.2</a>.</li>
</ul>
<p id="rfc.section.4.1.p.9">NOTE 1: According to <a href="#IPv6" class="xref">[IPv6]</a>, the highest-order two bits of the Option Type (i.e., the &#8220;act&#8221; bits) specify the action taken by a processing node that does not recognize Option Type. The required action is skip over this option and continue processing the header. Therefore, IANA is requested to assign this Option Type with &#8220;act&#8221; bits &#8220;00&#8221;.</p>
<p id="rfc.section.4.1.p.10">NOTE 2: According to <a href="#IPv6" class="xref">[IPv6]</a>, the third-highest-order bit (i.e., the &#8220;chg&#8221; bit) of the Option Type specifies whether Option Data can change on route to the packet&#8217;s destination. Because this option contains no Option Data, IANA can assign this Option Type without regard to the &#8220;chg&#8221; bit.</p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> <a href="#TruncatedOpt" id="TruncatedOpt">The Truncated Packet Option</a>
</h1>
<p id="rfc.section.4.2.p.1">The Truncated Packet option indicates that the packet has been truncated and is eligible for further truncation.</p>
<p id="rfc.section.4.2.p.2">The Truncated Packet option contains the following fields:</p>
<p></p>

<ul>
<li>Option Type - Truncated Packet option. Value TBD by IANA. See Notes below.</li>
<li>Opt Data Len - Length of Option Data, measured in bytes. MUST be equal to 0.</li>
</ul>
<p id="rfc.section.4.2.p.4">IPv6 packets that include the Fragment header MUST NOT include the Truncated Packet option.</p>
<p id="rfc.section.4.2.p.5">IPv6 packets whose length is less than the IPv6 minimum link MTU MUST NOT include the Truncated Packet option.</p>
<p id="rfc.section.4.2.p.6">The IPv6 Hop-by-hop Options header SHOULD NOT include the Truncated Packet option.</p>
<p id="rfc.section.4.2.p.7">The IPv6 Destination Options:</p>
<p></p>

<ul>
<li>MAY include a single instance of the Truncated Packet option.</li>
<li>SHOULD NOT include multiple instances of the Truncated Packet option.</li>
<li>MUST NOT include both the Truncated Packet option and the Truncation Eligible option.</li>
</ul>
<p id="rfc.section.4.2.p.9">NOTE 1: According to <a href="#IPv6" class="xref">[IPv6]</a>, the highest-order two bits of the Option Type (i.e., the &#8220;act&#8221; bits) specify the action taken by a processing node that does not recognize Option Type. The required action is to discard the packet and send an ICMP Parameter Problem, Code 2, message to the packet&#8217;s Source Address, pointing to the unrecognized Option Type. Therefore, IANA is requested to assign this Option Type with &#8220;act&#8221; bits &#8220;10&#8221;.</p>
<p id="rfc.section.4.2.p.10">NOTE 2: According to <a href="#IPv6" class="xref">[IPv6]</a>, the third-highest-order bit (i.e., the &#8220;chg&#8221; bit) of the Option Type specifies whether Option Data of that option can change on route to the packet&#8217;s destination. Because this option contains no Option Data, IANA can assign this Option Type without regard to the &#8220;chg&#8221; bit.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#ReferenceTopology" id="ReferenceTopology">Reference Topology</a>
</h1>
<div id="rfc.figure.1"></div>
<div id="RefTopoSect"></div>
<pre>
 -----------           -----------           -----------           -----------
|   Upper   |         |           |         |           |         |   Upper   |
|   Layer   |         |           |         |           |         |   Layer   |
|           |         |           |         |           |         |           |
|    IP     |&lt;-------&gt;|    IP     |&lt;-------&gt;|    IP     |&lt;-------&gt;|    IP     |
|   Layer   |   MTU   |   Layer   |   MTU   |   Layer   |   MTU   |   Layer   |
 -----------   9000    -----------   4000    -----------   1500    -----------
   Source                Router 1              Router 2            Destination
    Node                                                              Node
</pre>
<p class="figure">Figure 1: Reference Topology</p>
<p id="rfc.section.5.p.1">The reference network topology contains a Source Node, intermediate nodes (i.e., Router 1, Router 2), and a Destination Node. The link that connects the Source Node to Router 1 has an MTU of 9000 bytes. The link that connects Router 1 to Router 2 has an MTU of 4000 bytes, and the link that connects Router 2 to the Destination Node has an MTU of 1500 bytes. The PMTU between the Source Node and the Destination Node is 1500 bytes.</p>
<p id="rfc.section.5.p.2">This topology is used in examples throughout the document.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#signaling" id="signaling">Truncation Procedures</a>
</h1>
<p id="rfc.section.6.p.1">In the <a href="#ReferenceTopology" class="xref">Section 5</a>, the Source Node produces an initial estimate of the PMTU between itself and the Destination Node. This initial estimate equals the MTU of the first link on the path to the Destination Node (e.g., 9000 bytes).</p>
<p id="rfc.section.6.p.2">The Source Node refrains from sending packets whose length exceeds the above-mentioned estimate. However, the above-mentioned estimate is significantly larger than the actual PMTU (1500 bytes). Therefore, the Source Node may send packets whose length exceeds the actual PMTU.</p>
<p id="rfc.section.6.p.3">At some time in the future, an upper-layer protocol on the Source Node causes the IP layer to emit a packet. The packet contains a Destination Options header and the Destination Options header contains a Truncation Eligible option. The total packet length, including all headers and the payload, is 1350 bytes. Because the total packet length is less than the actual PMTU, this packet can be delivered to the Destination Node without encountering any MTU issues.</p>
<p id="rfc.section.6.p.4">The IP layer on the Source Node forwards the packet to the Router 1, Router 1 forwards the packet to Router 2, and the Router 2 forwards the packet to the Destination Node. The IP layer on the Destination Node examines the Destination Options header and finds the Truncation Eligible option. The Truncation Eligible option requires no action by the Destination Node. Therefore, the Destination Node processes the next header and delivers the packet to an upper-layer protocol.</p>
<p id="rfc.section.6.p.5">Subsequently, the same upper-layer protocol on the Source Node causes the IP layer to emit another packet. This packet is identical to the first, except that the total packet length is 2000 bytes. Because the packet length is greater than the actual PMTU, this packet cannot be delivered without encountering an MTU issue.</p>
<p id="rfc.section.6.p.6">The IP layer on the Source Node forwards the packet to Router 1.  Router 1 forwards the packet to Router 2, but the Router 2 cannot forward the packet because its length exceeds the MTU of the next link in the path (i.e., 1500 bytes). Because an MTU issue has been encountered, Router 2 examines the Destination Options header, searching for either a Truncation Eligible option or a Truncated Packet option.  (Normally, the Router 2 would ignore the Destination Options header).</p>
<p id="rfc.section.6.p.7">Because Router 2 finds one of the above-mentioned options, it:</p>
<p></p>

<ul>
<li>Sends an ICMP PTB message to the Source Node. The ICMP PTB message contains an MTU field indicating the MTU of the next link in the path (i.e. 1500 bytes).</li>
<li>Truncates the packet, so that its total length equals the MTU of the next link in the path.</li>
<li>Updates the IPv6 Payload Length.</li>
<li>Overwrites all instances of the Truncation Eligible option with a Truncated Packet option.</li>
<li>Updates the upper-layer checksum (if possible)</li>
<li>Forwards the packet to the Destination Node.</li>
</ul>
<p id="rfc.section.6.p.9">The IP layer on the Destination Node receives the packet and examines the Destination Options header. Because it finds the Truncated Packet option, it discards the packet and sends an ICMP PTB message to the Source Node. The MTU field in the ICMP PTB message represents the length of the received packet.</p>
<p id="rfc.section.6.p.10">When the Source Node receives the ICMP PTB message, it updates its PMTU estimate, as per <a href="#RFC8201" class="xref">[RFC8201]</a>.</p>
<p id="rfc.section.6.p.11">NOTE: A packet can be truncated multiple times. In the reference topology, assume that the Source Node sends a 5000 byte packet containing a Truncation Eligible option to the Destination Node. Using the above-mentioned procedures, Router 1 truncates the packet to 4000 bytes and Router 2 truncates it again, this time to 1500 bytes. The Destination Node receives the packet, discards it, and sends an ICMP PTB message to the Source Node. The MTU field in the ICMP PTB message represents the length of the received packet (i.e., 1500 bytes).</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#backwards-compatibility" id="backwards-compatibility">Backwards Compatibility</a>
</h1>
<p id="rfc.section.7.p.1">The <a href="#signaling" class="xref">Section 6</a> of this document assumes that all nodes recognize the Truncation Eligible and Truncated Packet options. This section explores backwards compatibility issues, where one or more nodes do not recognize the above-mentioned options.</p>
<p id="rfc.section.7.p.2">An intermediate node that does not recognize the above-mentioned options behaves exactly as described in <a href="#IPv6" class="xref">[IPv6]</a>. When it receives a packet that does not cause an MTU issue, it processes the packet. When it receives a packet that causes an MTU issue, it discards the packet and sends an ICMP PTB message to the source node. In neither case does the intermediate node examine the Destination Options header or truncate the packet.</p>
<p id="rfc.section.7.p.3">A destination node that does not recognize the Truncation Eligible option also behaves exactly as described in <a href="#IPv6" class="xref">[IPv6]</a>.  When it receives a packet that contains the Truncation Eligible option, its behavior is determined by the highest-order two bits of the Option Type (i.e., the &#8220;act&#8221; bits). Because the &#8220;act&#8221; bits are equal to &#8220;00&#8221;, the destination node skips over the option and continues to process the packet. This is exactly what the destination node would have done if it had recognized the Truncation Eligible option.</p>
<p id="rfc.section.7.p.4">A destination node that does not recognize the Truncated Packet option also behaves exactly as described in <a href="#IPv6" class="xref">[IPv6]</a>.  When it receives a packet that contains the Truncated Packet option, its behavior is determined by the highest-order two bits of the Option Type (i.e., the &#8220;act&#8221; bits). Because the &#8220;act&#8221; bits are equal to &#8220;10&#8221;, the destination node discards the packet and sends an ICMP Parameter Problem, Code 2, message to the packet&#8217;s Source Address, pointing to the Truncated Packet option. The destination node does not emit an ICMP PTB message.</p>
<p id="rfc.section.7.p.5">The source node takes appropriate action when it receives the ICMP Parameter Problem message.</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#checksum-considerations" id="checksum-considerations">Checksum Considerations</a>
</h1>
<p id="rfc.section.8.p.1">When an intermediate node truncates a packet, it SHOULD update the upper-layer checksum, if possible. This is desirable because it increases the probability that the truncated packet will be delivered to the destination node.</p>
<p id="rfc.section.8.p.2">Stateful middleboxes residing downstream of the intermediate node may attempt to validate the upper-layer checksum. If the validation fails, they may discard the packet without sending an ICMP message.</p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> <a href="#invalid-packet-types" id="invalid-packet-types">Invalid Packet Types</a>
</h1>
<p id="rfc.section.9.p.1">The following packet types are invalid:</p>
<p></p>

<ul>
<li>Packets that contain the Fragment header and the Truncation Eligible option.</li>
<li>Packets that contain the Fragment header and the Packet Truncated option.</li>
<li>Packets that contain the Truncation Eligible option and the Packet Truncated option.</li>
<li>Packets that specify an Option Data Length greater than 0 in the Truncation Eligible option.</li>
<li>Packets that specify an Option Data Length greater than 0 in the Truncated Packet option.</li>
<li>Packets that have a total length less than the IPv6 minimum link MTU and contain the Packet Truncated option.</li>
</ul>
<p id="rfc.section.9.p.3">If an intermediate node cannot forward one of the above-mentioned packets because of an MTU issue, its behavior is as described in <a href="#IPv6" class="xref">[IPv6]</a>. The intermediate node discards the packet and sends an ICMP PTB message to the source node. It does not truncate or forward the packet.</p>
<p id="rfc.section.9.p.4">When the destination node receives one of the above-mentioned packets, it MUST:</p>
<p></p>

<ul>
<li>Discard the packet</li>
<li>Send an ICMP Parameter Problem, Code 2, message to the packet&#8217;s Source Address, pointing to the first invalid option.</li>
</ul>
<p id="rfc.section.9.p.6">The destination node MUST NOT send an ICMP PTB message.</p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> <a href="#network-considerations" id="network-considerations">Network Considerations</a>
</h1>
<p id="rfc.section.10.p.1">The procedures described herein rely upon the networks ability:</p>
<p></p>

<ul>
<li>To convey packets that contain destination options from the source node to the destination node.</li>
<li>To convey ICMP Parameter Problem messages in the reverse direction.</li>
</ul>
<p id="rfc.section.10.p.3">Operational experience <a href="#RFC7872" class="xref">[RFC7872]</a> reveals that a significant number of networks drop packets that contain IPv6 destination options. Likewise, many networks drop ICMP Parameter Problem messages.</p>
<p><a href="#I-D.bonica-6man-unrecognized-opt" class="xref">[I-D.bonica-6man-unrecognized-opt]</a> describes procedures that upper-layer protocols can execute to verify that the above-mentioned requirements are satisfied. Upper-layer protocols can execute these procedures before emitting packets that contain the Truncation Eligible option.</p>
<h1 id="rfc.section.11">
<a href="#rfc.section.11">11.</a> <a href="#encapsulating-security-payload-considerations" id="encapsulating-security-payload-considerations">Encapsulating Security Payload Considerations</a>
</h1>
<p id="rfc.section.11.p.1">An IPv6 packet can contain both:</p>
<p></p>

<ul>
<li>An Encapsulating Security Payload (ESP) header <a href="#RFC4303" class="xref">[RFC4303]</a>.</li>
<li>Truncation options (i.e., the Truncation Eligible or Truncated Packet options).</li>
</ul>
<p id="rfc.section.11.p.3">In this case, the packet MUST contain a Destination Options header that precedes the ESP. That Destination Options header contains the truncation options and is not protected by the ESP. The packet MAY also contain another Destination Options header the follows the ESP.  That Destination Options header is protected by the ESP and MUST NOT contain the truncation options.</p>
<p id="rfc.section.11.p.4">As per <a href="#RFC4303" class="xref">[RFC4303]</a>, a packet can contain two Destination Options headers one preceding the ESP and one following the ESP.</p>
<h1 id="rfc.section.12">
<a href="#rfc.section.12">12.</a> <a href="#extension-header-considerations" id="extension-header-considerations">Extension Header Considerations</a>
</h1>
<p id="rfc.section.12.p.1">According to <a href="#IPv6" class="xref">[IPv6]</a>, the following IPv6 extension headers can contain options:</p>
<p></p>

<ul>
<li>The Hop-by-hop Options header.</li>
<li>The Destination Options header.</li>
</ul>
<p id="rfc.section.12.p.3">The Hop-by-hop option can be examined by each node along the path to a packet&#8217;s destination. Destination options are examined by the destination node only. However, <a href="#RFC2473" class="xref">[RFC2473]</a> provides a precedent for intermediate nodes examining the Destination options on an exception basis. (See the Tunnel Encapsulation Limit.)</p>
<p id="rfc.section.12.p.4">The truncation options described herein are examined by:</p>
<p></p>

<ul>
<li>Intermediate nodes, on an exception basis (i.e, when the packet cannot be forwarded due to MTU issues).</li>
<li>The Destination node.</li>
</ul>
<p id="rfc.section.12.p.6">Therefore, the above-mentioned options can be processed most efficiently when they are contained by the Destination Option header.  When contained by the Destination Options header, the above-mentioned options are examined by intermediate nodes on an exception basis, only when they are relevant. If contained by the Hop-by-hop Options header, they are always examined by intermediate nodes, even when they are irrelevant.</p>
<h1 id="rfc.section.13">
<a href="#rfc.section.13">13.</a> <a href="#Security" id="Security">Security Considerations</a>
</h1>
<p id="rfc.section.13.p.1">PMTUD is vulnerable to ICMP PTB forgery attacks. The procedures described herein do nothing to mitigate that vulnerability.</p>
<p id="rfc.section.13.p.2">The procedures described herein are susceptible to a new variation on that attack, in which an attacker forges a truncated packet. In this case, the attackers cause the Destination Node to produce an ICMP PTB message on their behalf. To some degree, this vulnerability is mitigated, because the Destination Node will not emit an ICMP PTB message in response to a truncated packet whose length is less than the IPv6 minimum link MTU.</p>
<p id="rfc.section.13.p.3">In order to mitigate denial of service attacks, intermediate nodes MUST rate limit the number of packets that they truncate per second.</p>
<h1 id="rfc.section.14">
<a href="#rfc.section.14">14.</a> <a href="#iana-considerations" id="iana-considerations">IANA Considerations</a>
</h1>
<p id="rfc.section.14.p.1">IANA is requested to allocate the following codepoints from the Destination Options and Hop-by-hop Options registry <a href="#IPv6Param" class="xref">[IPv6Param]</a>.</p>
<p></p>

<ul>
<li>Truncation Eligible (&#8220;act-bits&#8221; are &#8220;00. &#8220;chg-bit&#8221; can be either 0 or 1.)</li>
<li>Truncated Packet (&#8220;act-bits&#8221; are &#8220;10&#8221;. &#8220;chg-but can be either 0 or 1.)</li>
</ul>
<h1 id="rfc.section.15">
<a href="#rfc.section.15">15.</a> <a href="#Acknowledgements" id="Acknowledgements">Acknowledgements</a>
</h1>
<p id="rfc.section.15.p.1">Special thanks to Mike Heard, Geoff Huston, Joel Jaeggli, Tom Jones, Andy Smith, and Jinmei Tatuya who reviewed and commented on this document.</p>
<h1 id="rfc.references">
<a href="#rfc.references">16.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">16.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="IPv6">[IPv6]</b></td>
<td class="top">
<a>Deering, S.</a> and <a>R. Hinden</a>, "<a href="https://tools.ietf.org/html/rfc8200">Internet Protocol, Version 6 (IPv6) Specification</a>", STD 86, RFC 8200, DOI 10.17487/RFC8200, July 2017.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a>Bradner, S.</a>, "<a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4303">[RFC4303]</b></td>
<td class="top">
<a>Kent, S.</a>, "<a href="https://tools.ietf.org/html/rfc4303">IP Encapsulating Security Payload (ESP)</a>", RFC 4303, DOI 10.17487/RFC4303, December 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4443">[RFC4443]</b></td>
<td class="top">
<a>Conta, A.</a>, <a>Deering, S.</a> and <a>M. Gupta</a>, "<a href="https://tools.ietf.org/html/rfc4443">Internet Control Message Protocol (ICMPv6) for the Internet Protocol Version 6 (IPv6) Specification</a>", STD 89, RFC 4443, DOI 10.17487/RFC4443, March 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC8174">[RFC8174]</b></td>
<td class="top">
<a>Leiba, B.</a>, "<a href="https://tools.ietf.org/html/rfc8174">Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</a>", BCP 14, RFC 8174, DOI 10.17487/RFC8174, May 2017.</td>
</tr>
<tr>
<td class="reference"><b id="RFC8201">[RFC8201]</b></td>
<td class="top">
<a>McCann, J.</a>, <a>Deering, S.</a>, <a>Mogul, J.</a> and <a>R. Hinden</a>, "<a href="https://tools.ietf.org/html/rfc8201">Path MTU Discovery for IP version 6</a>", STD 87, RFC 8201, DOI 10.17487/RFC8201, July 2017.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">16.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="I-D.bonica-6man-unrecognized-opt">[I-D.bonica-6man-unrecognized-opt]</b></td>
<td class="top">
<a>Bonica, R.</a> and <a>J. Leddy</a>, "<a href="https://tools.ietf.org/html/draft-bonica-6man-unrecognized-opt-03">The IPv6 Probe Option</a>", Internet-Draft draft-bonica-6man-unrecognized-opt-03, August 2018.</td>
</tr>
<tr>
<td class="reference"><b id="IPv6Param">[IPv6Param]</b></td>
<td class="top">"<a href="https://www.iana.org/assignments/ipv6-parameters/ipv6-parameters.xhtml#ipv6-parameters-2">Internet Protocol Version 6 (IPv6) Parameters - Destination Options and Hop-by-Hop Options</a>", n.d..</td>
</tr>
<tr>
<td class="reference"><b id="RFC2473">[RFC2473]</b></td>
<td class="top">
<a>Conta, A.</a> and <a>S. Deering</a>, "<a href="https://tools.ietf.org/html/rfc2473">Generic Packet Tunneling in IPv6 Specification</a>", RFC 2473, DOI 10.17487/RFC2473, December 1998.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7690">[RFC7690]</b></td>
<td class="top">
<a>Byerly, M.</a>, <a>Hite, M.</a> and <a>J. Jaeggli</a>, "<a href="https://tools.ietf.org/html/rfc7690">Close Encounters of the ICMP Type 2 Kind (Near Misses with ICMPv6 Packet Too Big (PTB))</a>", RFC 7690, DOI 10.17487/RFC7690, January 2016.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7872">[RFC7872]</b></td>
<td class="top">
<a>Gont, F.</a>, <a>Linkova, J.</a>, <a>Chown, T.</a> and <a>W. Liu</a>, "<a href="https://tools.ietf.org/html/rfc7872">Observations on the Dropping of Packets with IPv6 Extension Headers in the Real World</a>", RFC 7872, DOI 10.17487/RFC7872, June 2016.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">John Leddy</span> 
	  <span class="n hidden">
		<span class="family-name">Leddy</span>
	  </span>
	</span>
	<span class="org vcardline">Unaffiliated</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:john@leddy.net">john@leddy.net</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Ron Bonica</span> 
	  <span class="n hidden">
		<span class="family-name">Bonica</span>
	  </span>
	</span>
	<span class="org vcardline">Juniper Networks</span>
	<span class="adr">
	  <span class="vcardline">2251 Corporate Park Drive</span>

	  <span class="vcardline">
		<span class="locality">Herndon</span>,  
		<span class="region">Virginia</span> 
		<span class="code">20171</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:rbonica@juniper.net">rbonica@juniper.net</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Igor Lubashev</span> 
	  <span class="n hidden">
		<span class="family-name">Lubashev</span>
	  </span>
	</span>
	<span class="org vcardline">Akamai Technologies</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:igorlord@alum.mit.edu">igorlord@alum.mit.edu</a></span>

  </address>
</div>

</body>
</html>
